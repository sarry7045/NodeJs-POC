<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Favorite Cities</title>
    <link rel="stylesheet" href="/styles.scss">
</head>

<body>
    <div style="margin-left: 500px;">
        <h2>Favorite Cities</h2>
        <input style="margin-left: -40px;" type="text" id="prefCity" placeholder="Add favorite city">
        <button onclick="addPreference()">Add</button>
        <ul id="prefList" style="margin-left: -62px; margin-bottom: '20px';"></ul>
    </div>
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        let token = urlParams.get('token') || localStorage.getItem('token');
        if (!token) {
            alert('Please login first');
            window.location.href = '/';
            throw new Error('No token available');
        }
        localStorage.setItem('token', token);


        // Load preferences
        fetch('/api/preferences', {
            headers: { 'Authorization': `Bearer ${token}` }
        })
            .then(res => res.json())
            .then(cities => {
                const list = document.getElementById('prefList');
                cities.forEach(city => {
                    const li = document.createElement('li');
                    li.textContent = `${city} `;
                    const btn = document.createElement('button');
                    btn.textContent = 'Remove';
                    btn.onclick = () => removePreference(city);
                    li.appendChild(btn);
                    list.appendChild(li);
                    prefList.appendChild(li);
                });
            });

        function addPreference() {
            const city = document.getElementById('prefCity').value.trim();
            if (!city) return alert('Enter a city');
            fetch('/api/preferences', {
                method: 'POST',
                headers: { 'Authorization': `Bearer ${token}`, 'Content-Type': 'application/json' },
                body: JSON.stringify({ city })
            })
                .then(res => res.text())
                .then(() => location.reload());
        }

        function removePreference(city) {
            fetch('/api/preferences', {
                method: 'DELETE',
                headers: { 'Authorization': `Bearer ${token}`, 'Content-Type': 'application/json' },
                body: JSON.stringify({ city })
            })
                .then(res => res.text())
                .then(() => location.reload());
        }
    </script>
    <p style="margin-left: 30px;"><a href="/dashboard">Back to Dashboard</a></p>
</body>

</html>